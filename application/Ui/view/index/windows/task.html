<!-- 任务窗口开始 -->
<div id="task" class="easyui-dialog dialog-form-style" title="任务系统" style="width:300px;height:'auto';text-align:center;padding:2px 2px 2px 2px"
          data-options="closed:true,modal:false,resizable:true,buttons:'#task-buttons'">
   <form id="task-form" action="task">
       <label>类型:</label>
       <input name="task.type"  class="easyui-combobox"  style="width:35%;"
               data-options="valueField:'id',
                                textField:'text',
                                url:'/static/js/combobox.json',
                                panelHeight:'auto'"/>
       <label>用户:</label>
       <input name="user"  class="easyui-combobox"  style="width:35%;"
               data-options="valueField:'id',
                                textField:'text',
                                url:'/static/js/combobox.json',
                                panelHeight:'auto'"/>
       <input name="task.comment" class="easyui-textbox"  style="width:100%;height:115px;" data-options="multiline:true">

        <label>时间：</label>
        <input name='task.task_time' class="easyui-datetimebox" style="width:80%" data-options="required:true,formatter:my2formatter,parser:my2parser">
   </form>
</div>

<div id="task-buttons">
    <a  class="easyui-linkbutton" iconCls="icon-ok" onclick="formSubmit('task','task-form',true)">提交</a>
    <a  class="easyui-linkbutton" iconCls="icon-cancel" onclick="closeDialog('task')">关闭</a>
</div>
<!-- 任务窗口结束 -->
<script type="text/javascript">
    /* 带窗口的表单提交
    * @param dialogid string 窗口ID
    * @param formid string  表单ID
    * @param getrow bool  获取选中行
    * @param action seting URL
    * */
    function formSubmit(dialogid,formid,getRow = false, action = false ){
        var url = null;
        //获取dg row
        var row = getRow ? getSingleSelectRow("dg"):null;
        var formParam = $('#' + formid).serialize();
        var key = action ? action : $('#' + formid).attr('action');
        if (config[key] == undefined ) config[key] = action;
        if (row != null ) {
            url = config[key] + row.Id;
            showConfirm("系统", "执行命令是否确认 ? ", function () {
                jsonAjax('post', url, formParam, function (ret) {
                    if (ret.code == Success) {
                        showMsg("完成", "提交成功", true);
                        closeDialog("#"+dialogid);
                    } else {
                        showMsg("错误", ret.msg, true,'error');
                    }
                })
            });
        } else {
            url = config[key];
            //console.log(config);
            jsonAjax('post',url,formParam,function(){
                if (ret.code == Success ) {
                    showMsg("完成", "提交成功", true);
                    closeDialog("#"+dialogid);
                } else {
                    showMsg("错误", ret.msg, true,'error');
                }
            })
        }
        if( url == undefined ) {
            alert("URL错误");
            console.info("key:"+key+" action:" + action);
        }
        console.info("URL:"+url);
    }
</script>