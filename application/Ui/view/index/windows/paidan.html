<!-- 外勤派单窗口开始 -->
<div id="pai-win" class="easyui-dialog" title="外勤派单" style="width:300px;height:'auto';text-align:center;"
     data-options="closed:true,modal:false,resizable:true,buttons:'#pai-buttons'">
    <form id ="paiform">
        <textarea style="width:97%;overflow:auto;word-break:break-all;" id="pai_comment"  name=comment rows=6 cols=25></textarea>
        <input id="idcard" name = 'card' type=hidden>

        <label>时间：</label>
        <input id='rcdate' name='rcdate' class="easyui-datetimebox" style="width:80%" data-options="required:true,formatter:my2formatter,parser:my2parser">
        <div class = 'hide'>
            <label>外勤：</label>
            <input id="wuser" name="wuser" style="width:80%;" />
            <script type="text/javascript">
                $('#wuser').combobox({
                    panelHeight:"auto",
                    url:'/ui/home/getwUserNameList',
                    valueField:'name',
                    textField:'name'
                })
                function my2formatter(date){
                    var y = date.getFullYear();
                    var m = date.getMonth()+1;
                    var d = date.getDate();
                    var h = date.getHours();
                    var min = date.getMinutes();
                    //var sec = date.getSeconds();

                    var str = y+'-'+(m<10?('0'+m):m)+'-'+(d<10?('0'+d):d)+' '+(h<10?('0'+h):h)+':'+(min<10?('0'+min):min);//+':'+(sec<10?('0'+sec):sec);
                    return str;
                };
                function my2parser(s){
                    if (!s) return new Date();
                    var y = s.substring(0,4);
                    var m = s.substring(5,7);
                    var d = s.substring(8,10);
                    var h = s.substring(11,13);
                    var min = s.substring(14,16);
                    //2017-08-07 14:00
                    //console.log(min);
                    //var sec = s.substring(18,20);
                    if (!isNaN(y) && !isNaN(m) && !isNaN(d) && !isNaN(h) && !isNaN(min) ){
                        return new Date(y,m-1,d,h,min);
                    } else {
                        return new Date();
                    }
                };
            </script>
        </div>
    </form>
</div>
<div id="pai-buttons">
    <a  class="easyui-linkbutton" iconCls="icon-ok" onclick="javascript:pai_save()">提交</a>
    <a  class="easyui-linkbutton" iconCls="icon-cancel" onclick="javascript:$('#pai-win').dialog('close')">取消</a>
</div>
<script type="text/javascript">
    //派单显示
    function pai_show(){
        var obj = $('#dg').datagrid('getSelected');
        if (!obj)return  $.messager.alert('警告','未选择任何数据!',"warning");
        //$('#paiform').form('load',obj);

        $('#rcdate').datetimebox('setValue', obj.rcdate);
        $('#wuser').combobox('setValue', obj.wuser)
        //obj.wuser != null ? $(".hide").hide() : $(".hide").show();
        $("#pai-win").dialog("open");//弹出窗口
        //$('#pai_comment').textbox('setText',obj.comment);
        $('#pai_comment').val(obj.comment);
        $('#idcard').val(obj.card);

    }
    //派单保存
    function pai_save(){
        $.ajax({
            type: "POST",
            async: false,
            dataType: "json",
            url: "/api/Gdata/pai",
            data: $("#paiform").serialize(),
            success: function(data){
                if ($('#dg_type').val()=='get') {
                    $('#dg').datagrid('reload');
                }else{
                    $('.searchbox-button').trigger("click");
                }
                if (data.code > 1 ) {
                    $("#pai-win").dialog("close");//关闭窗口
                    $.messager.alert('服务器消息',data.msg,"info");
                }else{
                    $.messager.alert('服务器消息',data.msg,"error");
                }
            }
        });
    }
    $(function(){

    });
</script>
<!-- 外勤派单窗口结束 -->